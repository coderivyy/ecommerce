

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Shopping Cart</title>
</head>
<body class="p-8 font-light">
    <h1 class="text-3xl font-light mb-6">Shopping Cart</h1>

    <div class="shopping-cart">
        <!-- Column labels -->
        <div class="hidden md:flex border-b border-gray-300 pb-3">
            <label class="w-1/5 text-center">Image</label>
            <label class="w-2/5">Product</label>
            <label class="w-1/5 text-center">Price</label>
            <label class="w-1/5 text-center">Quantity</label>
            <label class="w-1/5 text-center">Remove</label>
            <label class="w-1/5 text-right">Total</label>
        </div>

        <!-- Product list -->
        <% user.cart.forEach(function(product) { %>
        <div class="product flex py-5 border-b border-gray-300">
           
            <div class="w-full md:w-2/5 mb-4 md:mb-0">
                <div class="product-title text-lg font-medium mb-2"><%= product.product.name %></div>
            </div>
            <div class="w-1/2 md:w-1/5 text-center mb-4 md:mb-0">
                <div class="product-price">$<%= product.product.price %></div>
            </div>
            <div class="w-1/2 md:w-1/5 text-center mb-4 md:mb-0">
                <input type="number" value="<%= item.quantity %>" min="1" class="w-16 border border-gray-300 p-1 text-center">
            </div>
            <div class="w-full md:w-1/5 text-center mb-4 md:mb-0">
                <button class="remove-product bg-red-500 text-white py-1 px-2 rounded-md">Remove</button>
            </div>
            <div class="w-full md:w-1/5 text-right mb-4 md:mb-0">
                <div class="product-line-price">$<%= (product.product.price * product.quantity).toFixed(2) %></div>
            </div>
        </div>
        <% }) %>

        <!-- Totals -->
        <div class="totals mt-8">
            <div class="totals-item flex justify-between py-2">
                <label class="text-lg font-medium">Subtotal</label>
                <div class="totals-value" id="cart-subtotal">$<%= subtotal.toFixed(2) %></div>
            </div>
            <div class="totals-item flex justify-between py-2">
                <label class="text-lg font-medium">Tax (5%)</label>
                <div class="totals-value" id="cart-tax">$<%= tax.toFixed(2) %></div>
            </div>
            <div class="totals-item flex justify-between py-2">
                <label class="text-lg font-medium">Shipping</label>
                <div class="totals-value" id="cart-shipping">$15.00</div>
            </div>
            <div class="totals-item totals-item-total flex justify-between py-2 border-t border-gray-300 pt-4">
                <label class="text-lg font-medium">Grand Total</label>
                <div class="totals-value" id="cart-total">$<%= total.toFixed(2) %></div>
            </div>
        </div>

        <!-- Checkout button -->
        <button class="checkout bg-green-500 text-white py-3 px-6 rounded-md text-lg mt-4 float-right hover:bg-green-600">
            Checkout
        </button>
    </div>

    <!-- jQuery for dynamic functionality -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var taxRate = 0.05;
        var shippingRate = 15.00;
        var fadeTime = 300;

        $('.product-quantity input').change(function () {
            updateQuantity(this);
        });

        $('.remove-product').click(function () {
            removeItem(this);
        });

        function recalculateCart() {
            var subtotal = 0;

            $('.product').each(function () {
                subtotal += parseFloat($(this).find('.product-line-price').text().substring(1));
            });

            var tax = subtotal * taxRate;
            var shipping = (subtotal > 0 ? shippingRate : 0);
            var total = subtotal + tax + shipping;

            $('#cart-subtotal').text('$' + subtotal.toFixed(2));
            $('#cart-tax').text('$' + tax.toFixed(2));
            $('#cart-shipping').text('$' + shipping.toFixed(2));
            $('#cart-total').text('$' + total.toFixed(2));

            if (total === 0) {
                $('.checkout').fadeOut(fadeTime);
            } else {
                $('.checkout').fadeIn(fadeTime);
            }
        }

        function updateQuantity(quantityInput) {
            var productRow = $(quantityInput).closest('.product');
            var price = parseFloat(productRow.find('.product-price').text().substring(1));
            var quantity = $(quantityInput).val();
            var linePrice = price * quantity;

            productRow.find('.product-line-price').fadeOut(fadeTime, function () {
                $(this).text('$' + linePrice.toFixed(2));
                recalculateCart();
                $(this).fadeIn(fadeTime);
            });
        }

        function removeItem(removeButton) {
            var productRow = $(removeButton).closest('.product');
            productRow.slideUp(fadeTime, function () {
                productRow.remove();
                recalculateCart();
            });
        }
    </script>

</body>
</html>
